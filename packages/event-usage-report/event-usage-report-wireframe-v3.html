<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Usage Report — Wireframe v3.1</title>
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#FFFFFF;--fg:#0A0A0B;--muted:#F4F4F5;--muted-fg:#71717A;
    --border:#E4E4E7;--input:#E4E4E7;--ring:#18181B;--radius:8px;
    --primary:#18181B;--primary-fg:#FAFAFA;--accent:#F4F4F5;--accent-fg:#18181B;
    --destructive:#EF4444;
    --blue-50:#EFF6FF;--blue-100:#DBEAFE;--blue-600:#2563EB;
    --green-50:#F0FDF4;--green-500:#22C55E;--green-600:#16A34A;
    --orange-500:#F97316;--purple-500:#A855F7;--red-400:#F87171;
    --yellow-500:#EAB308;--cyan-500:#06B6D4;--pink-500:#EC4899;
    --amber-50:#FFFBEB;--amber-700:#B45309;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'Geist',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--fg);line-height:1.5;-webkit-font-smoothing:antialiased;}
  .page{max-width:1080px;margin:0 auto;padding:32px 24px 80px;}

  .page-header{margin-bottom:28px;}
  .page-title{font-size:22px;font-weight:700;letter-spacing:-0.4px;margin-bottom:6px;}
  .page-desc{font-size:14px;color:var(--muted-fg);margin-bottom:16px;}

  .desc-table{width:100%;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;font-size:13px;}
  .desc-table th,.desc-table td{padding:10px 16px;text-align:left;border-bottom:1px solid var(--border);}
  .desc-table th{background:var(--muted);font-weight:600;font-size:12px;color:var(--muted-fg);}
  .desc-table tr:last-child td{border-bottom:none;}
  .desc-table td:first-child{font-weight:500;white-space:nowrap;}
  .desc-table .flow{color:var(--muted-fg);font-size:12px;font-family:'Geist Mono',monospace;}

  .sep{height:1px;background:var(--border);margin:24px 0;}

  .app-bar{display:inline-flex;align-items:center;gap:10px;padding:10px 16px;background:var(--muted);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:24px;}
  .app-icon{width:30px;height:30px;border-radius:7px;background:linear-gradient(135deg,#F97316,#FB923C);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:13px;flex-shrink:0;}
  .app-name{font-size:14px;font-weight:600;}
  .app-meta{font-size:12px;color:var(--muted-fg);font-family:'Geist Mono',monospace;}

  /* Nudge */
  .nudge{display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-radius:var(--radius);font-size:13px;line-height:1.55;margin-bottom:16px;}
  .nudge strong{font-weight:600;}
  .nudge-icon{flex-shrink:0;width:18px;height:18px;display:flex;align-items:center;justify-content:center;border-radius:50%;font-size:11px;font-weight:700;margin-top:1px;}
  .nudge-tip{background:var(--amber-50);border:1px solid #FDE68A;color:var(--fg);}
  .nudge-tip .nudge-icon{background:#FDE68A;color:var(--amber-700);}
  .nudge-read{background:var(--muted);border:1px solid var(--border);color:var(--fg);}
  .nudge-read .nudge-icon{background:var(--border);color:var(--muted-fg);}

  .section{margin-bottom:36px;}
  .section-header{margin-bottom:16px;}
  .section-title{font-size:16px;font-weight:600;display:flex;align-items:center;gap:8px;margin-bottom:4px;}
  .section-desc{font-size:13px;color:var(--muted-fg);}
  .badge{font-size:11px;font-weight:500;padding:2px 8px;border-radius:9999px;background:var(--muted);color:var(--muted-fg);border:1px solid var(--border);}

  .card{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
  .card-content{padding:20px 24px;}

  .chart-area{background:var(--muted);border:1px dashed var(--border);border-radius:var(--radius);height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;color:var(--muted-fg);font-size:13px;}
  .chart-area svg{width:32px;height:32px;opacity:0.4;}
  .chart-area .chart-sub{font-size:11px;opacity:0.7;}
  .legend{display:flex;flex-wrap:wrap;gap:14px;margin-top:14px;}
  .legend-item{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted-fg);}
  .legend-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0;}

  .table-wrapper{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-top:16px;}
  .table-scroll{overflow-x:auto;max-height:280px;overflow-y:auto;}
  .data-table{width:100%;border-collapse:collapse;font-size:13px;}
  .data-table thead{position:sticky;top:0;z-index:1;}
  .data-table th{background:var(--muted);padding:10px 16px;text-align:left;font-weight:500;font-size:12px;color:var(--muted-fg);border-bottom:1px solid var(--border);white-space:nowrap;}
  .data-table td{padding:10px 16px;border-bottom:1px solid var(--border);white-space:nowrap;font-family:'Geist Mono',monospace;font-size:12px;}
  .data-table tbody tr:last-child td{border-bottom:none;}
  .data-table tbody tr:hover{background:var(--muted);}
  .data-table .num{text-align:right;font-variant-numeric:tabular-nums;}
  .data-table .date-cell{font-weight:500;}
  .col-desc td{font-family:'Geist',sans-serif!important;font-size:11px!important;color:var(--muted-fg)!important;padding:6px 16px!important;background:#FAFAFA;border-bottom:1px solid var(--border)!important;font-style:italic;}

  .sql-c{margin-top:16px;}
  .sql-t{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;font-size:12px;font-weight:500;font-family:'Geist Mono',monospace;color:var(--muted-fg);background:var(--muted);border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:all 0.15s;user-select:none;}
  .sql-t:hover{background:var(--accent);color:var(--accent-fg);}
  .sql-t .arrow{font-size:10px;transition:transform 0.2s;display:inline-block;}
  .sql-t.open .arrow{transform:rotate(90deg);}
  .sql-b{display:none;margin-top:8px;position:relative;}
  .sql-b.open{display:block;animation:fadeIn 0.15s ease;}
  .sql-code{background:#1E1E1E;border-radius:var(--radius);padding:16px 20px;font-family:'Geist Mono',monospace;font-size:12px;line-height:1.7;color:#D4D4D4;overflow-x:auto;white-space:pre;}
  .sql-code .kw{color:#569CD6;}.sql-code .str{color:#CE9178;}.sql-code .fn{color:#DCDCAA;}.sql-code .cm{color:#6A9955;font-style:italic;}.sql-code .nv{color:#B5CEA8;}
  .sql-cp{position:absolute;top:8px;right:8px;padding:4px 10px;font-size:11px;font-family:inherit;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);border-radius:6px;color:#A1A1AA;cursor:pointer;transition:all 0.15s;}
  .sql-cp:hover{background:rgba(255,255,255,0.15);color:#fff;}

  /* Date Picker */
  .dp-group{position:relative;}
  .dp-display{display:flex;align-items:center;gap:8px;height:36px;padding:0 12px;min-width:270px;border:1px solid var(--input);border-radius:var(--radius);font-size:13px;font-family:'Geist Mono',monospace;color:var(--fg);background:var(--bg);cursor:pointer;transition:border-color 0.15s,box-shadow 0.15s;user-select:none;}
  .dp-display:hover{border-color:#A1A1AA;}
  .dp-display.active{border-color:var(--ring);box-shadow:0 0 0 2px rgba(24,24,27,0.08);}
  .dp-display .dp-cal-icon{color:var(--muted-fg);font-size:13px;display:flex;align-items:center;}
  .dp-display .dp-cal-icon svg{width:15px;height:15px;}

  .cal-dd{display:none;position:absolute;top:calc(100% + 6px);left:0;z-index:50;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 8px 30px rgba(0,0,0,0.12);padding:16px;width:300px;}
  .cal-dd.open{display:block;animation:fadeIn 0.12s ease;}
  .cal-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
  .cal-hdr-title{font-size:14px;font-weight:600;}
  .cal-nav{background:none;border:1px solid var(--border);border-radius:6px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted-fg);font-size:12px;transition:all 0.15s;}
  .cal-nav:hover{background:var(--muted);color:var(--fg);}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center;}
  .cal-dow{font-size:11px;font-weight:500;color:var(--muted-fg);padding:4px 0;}
  .cal-day{font-size:13px;padding:7px 0;border-radius:6px;cursor:pointer;transition:all 0.1s;border:none;background:none;font-family:inherit;color:var(--fg);width:100%;}
  .cal-day:hover:not(.disabled):not(.other){background:var(--muted);}
  .cal-day.other{color:var(--muted-fg);opacity:0.3;pointer-events:none;}
  .cal-day.sel{background:var(--primary);color:var(--primary-fg);font-weight:600;}
  .cal-day.in-range{background:var(--blue-50);color:var(--blue-600);}
  .cal-day.today{border:1px solid var(--border);font-weight:600;}
  .cal-day.disabled{opacity:0.2;cursor:not-allowed;pointer-events:none;}
  .cal-foot{margin-top:12px;padding-top:12px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
  .cal-foot-hint{font-size:11px;color:var(--muted-fg);line-height:1.4;}
  .cal-foot-actions{display:flex;gap:6px;}

  /* Selection state indicator */
  .cal-state{font-size:11px;margin-bottom:10px;padding:6px 10px;border-radius:6px;text-align:center;}
  .cal-state-start{background:var(--blue-50);color:var(--blue-600);border:1px solid var(--blue-100);}
  .cal-state-end{background:var(--amber-50);color:var(--amber-700);border:1px solid #FDE68A;}
  .cal-state-done{background:var(--green-50);color:var(--green-600);border:1px solid #BBF7D0;}

  .usage-controls{display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap;margin-bottom:16px;}
  .form-group{display:flex;flex-direction:column;gap:6px;}
  .form-label{font-size:13px;font-weight:500;}
  .form-hint{font-size:11px;color:var(--muted-fg);font-weight:400;}

  .ev-label{font-size:13px;font-weight:500;margin-bottom:8px;display:block;}
  .chips-area{display:flex;align-items:center;flex-wrap:wrap;gap:6px;padding:8px 12px;border:1px solid var(--input);border-radius:var(--radius);min-height:40px;cursor:text;}
  .chips-area:focus-within{border-color:var(--ring);box-shadow:0 0 0 2px rgba(24,24,27,0.08);}
  .chip{display:inline-flex;align-items:center;gap:4px;padding:3px 8px 3px 10px;font-size:12px;font-weight:500;background:var(--destructive);color:white;border-radius:6px;}
  .chip-x{background:none;border:none;color:rgba(255,255,255,0.7);cursor:pointer;font-size:14px;line-height:1;padding:0 1px;transition:color 0.15s;}
  .chip-x:hover{color:white;}
  .chips-input{border:none;outline:none;font-size:13px;font-family:inherit;flex:1;min-width:100px;background:transparent;}
  .chips-input::placeholder{color:var(--muted-fg);}
  .chips-clear{background:none;border:none;color:var(--muted-fg);cursor:pointer;font-size:14px;padding:2px;margin-left:4px;transition:color 0.15s;}
  .chips-clear:hover{color:var(--fg);}

  .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;height:36px;padding:0 16px;border-radius:var(--radius);font-size:13px;font-weight:500;font-family:inherit;cursor:pointer;transition:all 0.15s;border:1px solid transparent;white-space:nowrap;}
  .btn-default{background:var(--primary);color:var(--primary-fg);border-color:var(--primary);}
  .btn-default:hover{background:#27272A;}
  .btn-outline{background:var(--bg);color:var(--fg);border-color:var(--input);}
  .btn-outline:hover{background:var(--accent);}
  .btn-sm{height:30px;padding:0 10px;font-size:12px;}

  .acc-item{border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px;overflow:hidden;}
  .acc-trig{display:flex;align-items:center;justify-content:space-between;width:100%;padding:14px 20px;background:var(--bg);border:none;font-size:14px;font-weight:500;font-family:inherit;color:var(--fg);cursor:pointer;transition:background 0.15s;text-align:left;}
  .acc-trig:hover{background:var(--muted);}
  .acc-trig .chev{font-size:14px;color:var(--muted-fg);transition:transform 0.2s;}
  .acc-trig.open .chev{transform:rotate(180deg);}
  .acc-body{display:none;border-top:1px solid var(--border);}
  .acc-body.open{display:block;animation:fadeIn 0.15s ease;}
  .acc-sec{padding:20px 24px;}
  .acc-sec+.acc-sec{border-top:1px solid var(--border);}
  .acc-sec-title{font-size:13px;font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:6px;}
  .acc-sec-title .dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
  .acc-sec-desc{font-size:12px;color:var(--muted-fg);margin-bottom:14px;line-height:1.5;}

  .wireframe-tag{position:fixed;bottom:16px;right:16px;background:var(--fg);color:var(--primary-fg);font-size:11px;font-weight:600;padding:6px 12px;border-radius:9999px;z-index:100;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(4px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<div class="page">

  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Event Usage Report</h1>
    <p class="page-desc">고객 앱의 이벤트 데이터 흐름을 확인하는 페이지입니다. 아래 두 영역으로 구성되어 있습니다.</p>
    <table class="desc-table">
      <thead><tr><th>영역</th><th>설명</th><th>데이터 흐름</th></tr></thead>
      <tbody>
        <tr><td>Event Collection Status</td><td>전체 이벤트 수집 현황 (최근 30일 고정, 자동 표시)</td><td class="flow">수집 (In)</td></tr>
        <tr><td>Event Usage</td><td>특정 이벤트의 리포트 조회 횟수 + 포스트백 발송 현황 (최대 31일, 이벤트 선택)</td><td class="flow">사용 (Query) → 발송 (Out)</td></tr>
      </tbody>
    </table>
  </div>

  <div class="sep"></div>

  <!-- App Info -->
  <div class="app-bar">
    <div class="app-icon">D</div>
    <div><div class="app-name">doctornow</div><div class="app-meta">ID: 24160 · Asia/Seoul</div></div>
  </div>

  <!-- ═══ Section 1: Collection Status ═══ -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">Event Collection Status <span class="badge">최근 30일 고정</span></div>
      <div class="section-desc">이 앱에서 수집되고 있는 전체 이벤트의 일별 추이입니다. 이벤트 소스별로 수집량이 정상적인지 한눈에 확인할 수 있습니다.</div>
    </div>
    <div class="card">
      <div class="card-content">
        <div class="chart-area">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3v18h18"/><path d="M7 16l4-8 4 4 4-8"/></svg>
          이벤트 수집 추이
          <div class="chart-sub">X축: 날짜 · Y축: 이벤트 수 · 시리즈: event_source별</div>
        </div>
        <div class="nudge nudge-read" style="margin-top:12px;">
          <span class="nudge-icon">?</span>
          <span>각 선은 <strong>이벤트 소스(event_source)</strong>별 수집량입니다. 특정 소스의 수치가 갑자기 0이 되거나 급감하면 해당 소스에서 이벤트 수집에 문제가 있을 수 있습니다.</span>
        </div>
        <div class="legend">
          <div class="legend-item"><span class="legend-dot" style="background:var(--blue-600);"></span>app 9160</div>
          <div class="legend-item"><span class="legend-dot" style="background:var(--purple-500);"></span>app 9161</div>
          <div class="legend-item"><span class="legend-dot" style="background:var(--red-400);"></span>app 9162</div>
          <div class="legend-item"><span class="legend-dot" style="background:var(--yellow-500);"></span>app 9167</div>
          <div class="legend-item"><span class="legend-dot" style="background:var(--green-500);"></span>app 9269</div>
        </div>
        <div class="table-wrapper"><div class="table-scroll">
          <table class="data-table">
            <thead><tr><th>Date</th><th class="num">app 9160</th><th class="num">app 9161</th><th class="num">app 9162</th><th class="num">app 9167</th><th class="num">app 9269</th></tr></thead>
            <tbody>
              <tr class="col-desc"><td>수집일</td><td class="num" colspan="5" style="text-align:center;">event_source별 이벤트 수집 건수</td></tr>
              <tr><td class="date-cell">2026-02-03</td><td class="num">58,496</td><td class="num">5,861</td><td class="num">8,408</td><td class="num">0</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-02-02</td><td class="num">64,420</td><td class="num">6,316</td><td class="num">9,350</td><td class="num">0</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-02-01</td><td class="num">39,780</td><td class="num">5,325</td><td class="num">4,560</td><td class="num">0</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-01-31</td><td class="num">45,257</td><td class="num">5,026</td><td class="num">6,635</td><td class="num">0</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-01-30</td><td class="num">51,764</td><td class="num">5,065</td><td class="num">7,515</td><td class="num">1</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-01-29</td><td class="num">52,766</td><td class="num">5,412</td><td class="num">7,671</td><td class="num">0</td><td class="num">0</td></tr>
              <tr><td class="date-cell">2026-01-28</td><td class="num">52,945</td><td class="num">5,946</td><td class="num">8,045</td><td class="num">0</td><td class="num">1</td></tr>
            </tbody>
          </table>
        </div></div>
        <div class="sql-c">
          <button class="sql-t" onclick="toggleSQL(this)"><span class="arrow">▶</span> SQL Query</button>
          <div class="sql-b">
            <button class="sql-cp" onclick="copySQL(this)">Copy</button>
            <div class="sql-code"><span class="kw">SELECT</span>
    date_start <span class="kw">AS</span> dt,
    event_source,
    event_category,
    <span class="fn">SUM</span>(event_count) <span class="kw">AS</span> events
<span class="kw">FROM</span> AIROFFICE.PUBLIC.DRUID_ACTUALS_REPORT_DAILY
<span class="kw">WHERE</span> app_id = <span class="nv">24160</span>
<span class="kw">AND</span> date_start >= CURRENT_DATE - INTERVAL <span class="str">'30 DAY'</span>
<span class="kw">AND</span> date_start < CURRENT_DATE
<span class="kw">AND</span> event_source <span class="kw">NOT IN</span> (<span class="str">'tracking_link'</span>)
<span class="kw">GROUP BY</span> 1, 2, 3
<span class="kw">ORDER BY</span> 1, 2, 3</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sep"></div>

  <!-- ═══ Section 2: Event Usage ═══ -->
  <div class="section">
    <div class="section-header">
      <div class="section-title">Event Usage</div>
      <div class="section-desc">특정 이벤트를 선택하면, 해당 이벤트가 리포트에서 조회된 횟수(Report Usage)와 외부 매체로 발송된 횟수(Postback)를 함께 확인할 수 있습니다.</div>
    </div>

    <div class="nudge nudge-tip">
      <span class="nudge-icon">!</span>
      <div><strong>사용 방법</strong> — 아래에서 조회 기간을 선택하고, 확인할 이벤트를 추가한 뒤 <strong>Run Query</strong>를 누르세요. 선택한 이벤트별로 결과가 펼침 목록으로 표시됩니다.</div>
    </div>

    <div class="usage-controls">
      <div class="form-group">
        <label class="form-label">Date <span class="form-hint">(최대 31일)</span></label>
        <div class="dp-group">
          <div class="dp-display" id="dpDisplay" onclick="toggleCal()">
            <span class="dp-cal-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg></span>
            <span id="dpText">2026-01-28 – 2026-02-04</span>
          </div>
          <div class="cal-dd" id="calDD">
            <div id="calState" class="cal-state cal-state-done">선택 완료: 8일</div>
            <div class="cal-hdr">
              <button class="cal-nav" onclick="chgMonth(-1)">◀</button>
              <span class="cal-hdr-title" id="calTitle"></span>
              <button class="cal-nav" onclick="chgMonth(1)">▶</button>
            </div>
            <div class="cal-grid" id="calGrid"></div>
            <div class="cal-foot">
              <span class="cal-foot-hint" id="calHint"></span>
              <div class="cal-foot-actions">
                <button class="btn btn-outline btn-sm" onclick="resetD()">초기화</button>
                <button class="btn btn-default btn-sm" id="applyBtn" onclick="applyD()">적용</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="btn btn-default" onclick="runQuery()">Run Query</button>
    </div>

    <label class="ev-label">Events want to check usage:</label>
    <div class="chips-area">
      <span class="chip">9161 <button class="chip-x">✕</button></span>
      <span class="chip">9360$ad_bann... <button class="chip-x">✕</button></span>
      <span class="chip">9360$add_fami... <button class="chip-x">✕</button></span>
      <input class="chips-input" type="text" placeholder="이벤트 ID 검색 후 추가...">
      <button class="chips-clear" title="전체 삭제">✕</button>
    </div>

    <!-- Results -->
    <div style="margin-top:20px;" id="results">

      <div class="acc-item">
        <button class="acc-trig open" onclick="toggleAcc(this)">9161 usage status<span class="chev">▼</span></button>
        <div class="acc-body open">

          <div class="acc-sec">
            <div class="acc-sec-title"><span class="dot" style="background:var(--blue-600);"></span> Report Usage</div>
            <div class="acc-sec-desc">이 이벤트(9161)가 Airbridge 리포트에서 조회된 횟수입니다. 어떤 리포트 유형(actuals, funnel, retention 등)에서 사용되었는지 확인할 수 있습니다. 수치가 높을수록 고객이 이 이벤트를 리포트에서 활발히 조회하고 있다는 뜻입니다.</div>
            <div class="chart-area" style="height:180px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:28px;height:28px;"><path d="M3 3v18h18"/><path d="M7 16l4-8 4 4 4-8"/></svg>
              리포트 조회 추이
              <div class="chart-sub">X축: 날짜 · Y축: 조회 횟수 · 시리즈: 리포트 API별</div>
            </div>
            <div class="legend">
              <div class="legend-item"><span class="legend-dot" style="background:var(--blue-600);"></span>actuals_v5_1</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--cyan-500);"></span>funnel_v1_2</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--red-400);"></span>retention_v5</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--pink-500);"></span>revenue_v4</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--green-500);"></span>trend_v3_2</div>
            </div>
            <div class="table-wrapper"><div class="table-scroll">
              <table class="data-table">
                <thead><tr><th>Date</th><th class="num">actuals_v5_1</th><th class="num">funnel_v1_2</th><th class="num">retention_v5</th><th class="num">revenue_v4</th><th class="num">trend_v3_2</th></tr></thead>
                <tbody>
                  <tr class="col-desc"><td>조회일</td><td class="num" colspan="5" style="text-align:center;">리포트 API별 조회 횟수</td></tr>
                  <tr><td class="date-cell">2026-02-04</td><td class="num">10</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-02-03</td><td class="num">235</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-02-02</td><td class="num">348</td><td class="num">0</td><td class="num">0</td><td class="num">1</td><td class="num">1</td></tr>
                  <tr><td class="date-cell">2026-02-01</td><td class="num">10</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-31</td><td class="num">10</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-30</td><td class="num">88</td><td class="num">5</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-29</td><td class="num">152</td><td class="num">5</td><td class="num">2</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-28</td><td class="num">101</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">1</td></tr>
                </tbody>
              </table>
            </div></div>
            <div class="sql-c">
              <button class="sql-t" onclick="toggleSQL(this)"><span class="arrow">▶</span> SQL Query</button>
              <div class="sql-b">
                <button class="sql-cp" onclick="copySQL(this)">Copy</button>
                <div class="sql-code"><span class="kw">SELECT</span>
    <span class="fn">CAST</span>(created_at <span class="kw">AS</span> date) <span class="kw">AS</span> dt, api,
    <span class="fn">COUNT</span>(*) <span class="kw">AS</span> cnt
<span class="kw">FROM</span> tbl_query_tasks
<span class="kw">WHERE</span> app_id = <span class="nv">24160</span>
<span class="kw">AND</span> created_at >= <span class="str">'2026-01-28'</span>
<span class="kw">AND</span> created_at < <span class="str">'2026-02-05'</span>
<span class="kw">AND</span> query <span class="kw">LIKE</span> <span class="str">'%%9161%%'</span>
<span class="kw">GROUP BY</span> 1, 2 <span class="kw">ORDER BY</span> 1, 2</div>
              </div>
            </div>
          </div>

          <div class="acc-sec">
            <div class="acc-sec-title"><span class="dot" style="background:var(--orange-500);"></span> Postback Sent Status</div>
            <div class="acc-sec-desc">이 이벤트(9161)가 외부 광고 매체(Facebook, Google, Appier 등)로 발송된 포스트백 횟수입니다. 특정 매체의 수치가 0이면 포스트백 설정이나 발송에 문제가 있을 수 있습니다. google.adwords 계열은 전체 이벤트를 전송하므로 이 차트에서 제외됩니다.</div>
            <div class="chart-area" style="height:180px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:28px;height:28px;"><path d="M3 3v18h18"/><path d="M7 12l4-4 4 6 4-8"/></svg>
              포스트백 발송 추이
              <div class="chart-sub">X축: 날짜 · Y축: 발송 횟수 · 시리즈: 매체(req_target)별</div>
            </div>
            <div class="legend">
              <div class="legend-item"><span class="legend-dot" style="background:var(--blue-600);"></span>appier</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--purple-500);"></span>facebook.biz</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--red-400);"></span>fb.biz_audit</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--yellow-500);"></span>google.adw</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--green-500);"></span>ga4</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--orange-500);"></span>moloco</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--cyan-500);"></span>tiktok</div>
              <div class="legend-item"><span class="legend-dot" style="background:var(--pink-500);"></span>toss</div>
            </div>
            <div class="table-wrapper"><div class="table-scroll">
              <table class="data-table">
                <thead><tr><th>Date</th><th class="num">appier</th><th class="num">fb.biz</th><th class="num">fb.audit</th><th class="num">google.adw</th><th class="num">ga4</th><th class="num">moloco</th><th class="num">tiktok</th><th class="num">toss</th></tr></thead>
                <tbody>
                  <tr class="col-desc"><td>발송일</td><td class="num" colspan="8" style="text-align:center;">매체별 포스트백 발송 횟수</td></tr>
                  <tr><td class="date-cell">2026-02-04</td><td class="num">318</td><td class="num">11</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-02-03</td><td class="num">5,352</td><td class="num">344</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-02-02</td><td class="num">5,755</td><td class="num">327</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-02-01</td><td class="num">4,880</td><td class="num">336</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-31</td><td class="num">4,618</td><td class="num">264</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-30</td><td class="num">4,643</td><td class="num">256</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-29</td><td class="num">4,909</td><td class="num">289</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                  <tr><td class="date-cell">2026-01-28</td><td class="num">5,411</td><td class="num">338</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td><td class="num">0</td></tr>
                </tbody>
              </table>
            </div></div>
            <div class="sql-c">
              <button class="sql-t" onclick="toggleSQL(this)"><span class="arrow">▶</span> SQL Query</button>
              <div class="sql-b">
                <button class="sql-cp" onclick="copySQL(this)">Copy</button>
                <div class="sql-code"><span class="kw">SELECT</span>
    <span class="fn">DATE_TRUNC</span>(DAY, DATA__REQUEST__TIMESTAMP)::DATE <span class="kw">AS</span> dt,
    DATA__REQUEST__TARGET <span class="kw">AS</span> req_target,
    DATA__REQUEST__PRODUCEDBY <span class="kw">AS</span> req_produced_by,
    <span class="fn">COUNT</span>(*) <span class="kw">AS</span> sent_count
<span class="kw">FROM</span> INTERNAL_POSTBACK_LOGS
<span class="kw">WHERE</span> DATA__APPID = <span class="nv">24160</span>
<span class="kw">AND</span> DATA__REQUEST__TIMESTAMP >= <span class="str">'2026-01-28'</span>
<span class="kw">AND</span> DATA__REQUEST__TIMESTAMP < <span class="str">'2026-02-05'</span>
<span class="cm">-- google ads sends all events, exclude them</span>
<span class="kw">AND</span> DATA__REQUEST__TARGET <span class="kw">NOT IN</span> (<span class="str">'google.adwords'</span>, <span class="str">'google.adwords.crossnetwork'</span>)
<span class="kw">AND</span> DATA__EVENTDATA__CATEGORY <span class="kw">IN</span> (<span class="str">'9161'</span>)
<span class="kw">GROUP BY</span> 1, 2, 3 <span class="kw">ORDER BY</span> 1, 2, 3</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="acc-item">
        <button class="acc-trig" onclick="toggleAcc(this)">9360$ad_banner_click usage status<span class="chev">▼</span></button>
        <div class="acc-body"></div>
      </div>
      <div class="acc-item">
        <button class="acc-trig" onclick="toggleAcc(this)">9360$add_family_doctor usage status<span class="chev">▼</span></button>
        <div class="acc-body"></div>
      </div>
    </div>
  </div>
</div>

<div class="wireframe-tag">WIREFRAME v3.1</div>

<script>
  function toggleSQL(b){b.classList.toggle('open');b.nextElementSibling.classList.toggle('open');}
  function copySQL(b){const c=b.nextElementSibling;navigator.clipboard.writeText(c.innerText).then(()=>{b.textContent='Copied!';setTimeout(()=>b.textContent='Copy',1500);});}
  function toggleAcc(b){b.classList.toggle('open');b.nextElementSibling.classList.toggle('open');}

  // ═══ Calendar Date Picker ═══
  let calOpen = false;
  let cMonth = 0, cYear = 2026; // viewing month (Jan 2026)
  let sDate = new Date(2026, 0, 28);
  let eDate = new Date(2026, 1, 4);
  let phase = 'done'; // 'picking-start' | 'picking-end' | 'done'
  const MX = 31;
  const MN = ['January','February','March','April','May','June','July','August','September','October','November','December'];

  function toggleCal() {
    calOpen = !calOpen;
    const dd = document.getElementById('calDD');
    const dp = document.getElementById('dpDisplay');
    if (calOpen) {
      dd.classList.add('open');
      dp.classList.add('active');
      // Set view to start date month
      if (sDate) { cMonth = sDate.getMonth(); cYear = sDate.getFullYear(); }
      renderCal();
    } else {
      dd.classList.remove('open');
      dp.classList.remove('active');
    }
  }

  document.addEventListener('click', e => {
    const g = document.querySelector('.dp-group');
    if (g && !g.contains(e.target) && calOpen) {
      calOpen = false;
      document.getElementById('calDD').classList.remove('open');
      document.getElementById('dpDisplay').classList.remove('active');
    }
  });

  function chgMonth(d) {
    cMonth += d;
    if (cMonth > 11) { cMonth = 0; cYear++; }
    if (cMonth < 0) { cMonth = 11; cYear--; }
    renderCal();
  }

  function daysIn(y, m) { return new Date(y, m + 1, 0).getDate(); }
  function firstDay(y, m) { return new Date(y, m, 1).getDay(); }
  function fmt(d) { return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); }
  function same(a, b) { return a && b && a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate(); }
  function diffD(a, b) { return Math.round(Math.abs((b - a) / 86400000)); }
  function inRange(d) { return sDate && eDate && d > sDate && d < eDate; }

  function renderCal() {
    document.getElementById('calTitle').textContent = MN[cMonth] + ' ' + cYear;
    const g = document.getElementById('calGrid');
    const today = new Date(2026, 1, 4);
    let h = '<div class="cal-dow">Su</div><div class="cal-dow">Mo</div><div class="cal-dow">Tu</div><div class="cal-dow">We</div><div class="cal-dow">Th</div><div class="cal-dow">Fr</div><div class="cal-dow">Sa</div>';

    const fd = firstDay(cYear, cMonth);
    const dm = daysIn(cYear, cMonth);
    const pm = daysIn(cYear, cMonth - 1);

    for (let i = fd - 1; i >= 0; i--) h += `<button class="cal-day other">${pm - i}</button>`;

    for (let d = 1; d <= dm; d++) {
      const dt = new Date(cYear, cMonth, d);
      let c = 'cal-day';
      if (same(dt, today)) c += ' today';
      if (same(dt, sDate) || same(dt, eDate)) c += ' sel';
      if (inRange(dt)) c += ' in-range';

      // Disable logic: only when picking end date
      if (phase === 'picking-end' && sDate) {
        // Disable dates before start
        if (dt < sDate) c += ' disabled';
        // Disable dates beyond 31 days from start
        if (diffD(sDate, dt) > MX) c += ' disabled';
        // Disable same day as start
        if (same(dt, sDate)) c += ' disabled';
      }

      h += `<button class="${c}" onclick="pickDay(${cYear},${cMonth},${d})">${d}</button>`;
    }

    const rem = (7 - (fd + dm) % 7) % 7;
    for (let i = 1; i <= rem; i++) h += `<button class="cal-day other">${i}</button>`;

    g.innerHTML = h;
    updateState();
  }

  function pickDay(y, m, d) {
    const dt = new Date(y, m, d);

    if (phase === 'done' || phase === 'picking-start') {
      // Always start fresh: set as new start date
      sDate = dt;
      eDate = null;
      phase = 'picking-end';
    } else if (phase === 'picking-end') {
      // Picking end date
      if (dt <= sDate) {
        // Clicked before or on start → restart with this as new start
        sDate = dt;
        eDate = null;
        phase = 'picking-end';
      } else if (diffD(sDate, dt) > MX) {
        // Beyond 31 days → ignore (shouldn't happen due to disabled)
        return;
      } else {
        // Valid end date
        eDate = dt;
        phase = 'done';
      }
    }
    renderCal();
  }

  function updateState() {
    const stateEl = document.getElementById('calState');
    const hintEl = document.getElementById('calHint');
    const applyBtn = document.getElementById('applyBtn');

    if (phase === 'picking-end' && sDate && !eDate) {
      stateEl.className = 'cal-state cal-state-end';
      stateEl.textContent = '시작일: ' + fmt(sDate) + ' — 종료일을 선택하세요';
      hintEl.textContent = '시작일로부터 최대 31일까지 선택 가능합니다';
      applyBtn.style.opacity = '0.4';
      applyBtn.style.pointerEvents = 'none';
    } else if (phase === 'done' && sDate && eDate) {
      const days = diffD(sDate, eDate);
      stateEl.className = 'cal-state cal-state-done';
      stateEl.textContent = '선택 완료: ' + fmt(sDate) + ' – ' + fmt(eDate) + ' (' + days + '일)';
      hintEl.textContent = '다른 기간을 선택하려면 날짜를 다시 클릭하세요';
      applyBtn.style.opacity = '1';
      applyBtn.style.pointerEvents = 'auto';
    } else {
      stateEl.className = 'cal-state cal-state-start';
      stateEl.textContent = '시작일을 선택하세요';
      hintEl.textContent = '';
      applyBtn.style.opacity = '0.4';
      applyBtn.style.pointerEvents = 'none';
    }
  }

  function resetD() {
    sDate = null;
    eDate = null;
    phase = 'picking-start';
    renderCal();
  }

  function applyD() {
    if (sDate && eDate) {
      document.getElementById('dpText').textContent = fmt(sDate) + ' – ' + fmt(eDate);
      toggleCal();
    }
  }

  function runQuery() {
    document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
</script>
</body>
</html>
